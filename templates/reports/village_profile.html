{% extends 'base.html' %}
{% load static %}
{% block contents %}
{% include 'partials/filter_report.html' %}

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <form action=""  method="POST" >
                    {% csrf_token %}
                    <div class="d-flex justify-content-end mb-3"> 
                        {% for key, values in filter_values.items %}
                            <input type="hidden" id="__hd1__{{key}}" name='{{key}}' value="{{values}}"/>
                        {% endfor %}
                        <button type="submit" name='export'  class="btn btn-primary waves-effect justify-content-start" value="True">
                             Export
                         </button>  
                    </div>
                </form>
                <div class="table-responsive mb-3" data-pattern="priority-columns">
                    <table id="tech-companies-1" class="table table-bordered dt-responsive mb-0">
                        <thead>
                            <tr>
                                <th>PHC Name</th>
                                <th>Sub Centre</th>
                                <th>Village</th>
                                <th>House hold</th>
                                <th>Individual</th>
                                <th>Code</th>
                                <th>Name</th>
                                <th>Head of the family</th>
                                <th>Age</th>
                                <th>Gender</th>
                                <th>Phone No</th>
                                <th>Resident in the village since last 6 month</th>
                                <th>Name of the ASHA</th>
                                <th>Name of FLHW</th>
                                <th>Phone no of FLHW</th>
                                <th>Name of ANM</th>
                                <th>Phone no of ANM</th>
                                <th>Name of CHO</th>
                                <th>Phone no of CHO</th>
                                <th>Name of MO</th>
                                <th>Phone no of MO</th>
                                <th>Voter ID</th>
                                <th>Aadhar</th>
                                <th>Health card</th>
                                <th>Ayushman bharath card</th>
                                <th>Ayushman bharath card no</th>
                                <th>Ration card no</th>
                                <th>Ration card no type</th>
                                <th>HTN</th>
                                <th>DM</th>
                                <th>Both</th>
                                <th>Detected by</th>
                                <th>Detected since</th>
                                <th>On Treatment</th>
                                <th>Physician visit in last 6 months</th>
                                <th>Facility</th>
                                <th>Facility 1</th>
                                <th>Facility 2</th>
                                <th>Facility 3</th>
                                <th>Medicine charges</th>
                                <th>Consultation</th>
                                <th>Diagnostics</th>
                                <th>Informal fees</th>
                                <th>Total direct cost</th>
                                <th>Food</th>
                                <th>Travelling</th>
                                <th>Total indirect cost</th>
                                <th>Daily wage loss</th>
                                <th>Opportunity cost</th>
                                <th>BP MED 1</th>
                                <th>BP MED 2</th>
                                <th>BP MED 3</th>
                                <th>DM MED 1</th>
                                <th>DM MED 2</th>
                                <th>Statins</th>
                                <th>Tobacco</th>
                                <th>Alcohol</th>
                                <th>Smoking</th>
                                <th>Family history</th>
                                <th>Date</th>
                                <th>Source of treatment</th>
                                <th>Height</th>
                                <th>Weight</th>
                                <th>BMI</th>
                                <th>SBP</th>
                                <th>DBP</th>
                                <th>FBS</th>
                                <th>PPBS</th>
                                <th>RBS</th>
                                <th>Diagnosis</th>
                                <th>NCD treatment</th>
                                <th>Non NCD treatment</th>
                                <th>Past history</th>
                                <th>Remarks</th>
                                <th>Created On</th>                                   
                            </tr>
                        </theah>
                        <tbody>
                            {% for vp in data %}
                            <tr>
                                <td>{{vp.village.subcenter.phc|default_if_none:''}}</td>
                                <td>{{vp.village.subcenter|default_if_none:''}}</td>
                                <td>{{vp.village|default_if_none:''}}</td>
                                <td>{{vp.house_hold|default_if_none:''}}</td>
                                <td>{{vp.individual|default_if_none:''}}</td>
                                <td>{{vp.code|default_if_none:''}}</td>
                                <td>{{vp.name|default_if_none:''}}</td>
                                <td>{{vp.head_of_the_family|default_if_none:''}}</td>
                                <td>{{vp.age}}</td>
                                <td>{{vp.gender|default_if_none:''}}</td>
                                <td>{{vp.phone_no|default_if_none:''}}</td>
                                <td>{{vp.resident_in_the_village_since_last_6_month|default_if_none:''}}</td>
                                <td>{{vp.name_of_the_asha|default_if_none:''}}</td>
                                <td>{{vp.name_of_flhw|default_if_none:''}}</td>
                                <td>{{vp.phone_no_of_flhw|default_if_none:''}}</td>
                                <td>{{vp.name_of_anm|default_if_none:''}}</td>
                                <td>{{vp.phone_no_of_anm|default_if_none:''}}</td>
                                <td>{{vp.name_of_cho|default_if_none:''}}</td>
                                <td>{{vp.phone_no_of_cho|default_if_none:''}}</td>
                                <td>{{vp.name_of_mo|default_if_none:''}}</td>
                                <td>{{vp.phone_no_of_mo|default_if_none:''}}</td>
                                <td>{{vp.voter_id|default_if_none:''}}</td>
                                <td>{{vp.aadhar|default_if_none:''}}</td>
                                <td>{{vp.health_card|default_if_none:''}}</td>
                                <td>{{vp.ayushman_bharath_card|default_if_none:''}}</td>
                                <td>{{vp.ayushman_bharath_card_no|default_if_none:''}}</td>
                                <td>{{vp.ration_card_no|default_if_none:''}}</td>
                                <td>{{vp.ration_card_no_type|default_if_none:''}}</td>
                                <td>{{vp.htn|default_if_none:''}}</td>
                                <td>{{vp.dm|default_if_none:''}}</td>
                                <td>{{vp.both|default_if_none:''}}</td>
                                <td>{{vp.detected_by|default_if_none:''}}</td>
                                <td>{{vp.detected_since|default_if_none:''}}</td>
                                <td>{{vp.on_treatment|default_if_none:''}}</td>
                                <td>{{vp.physician_visit_in_last_6_months|default_if_none:''}}</td>
                                <td>{{vp.facility|default_if_none:''}}</td>
                                <td>{{vp.facility_1|default_if_none:''}}</td>
                                <td>{{vp.facility_2|default_if_none:''}}</td>
                                <td>{{vp.facility_3|default_if_none:''}}</td>
                                <td>{{vp.medicine_charges|default_if_none:''}}</td>
                                <td>{{vp.consultation|default_if_none:''}}</td>
                                <td>{{vp.diagnostics|default_if_none:''}}</td>
                                <td>{{vp.informal_fees|default_if_none:''}}</td>
                                <td>{{vp.total_direct_cost|default_if_none:''}}</td>
                                <td>{{vp.food|default_if_none:''}}</td>
                                <td>{{vp.travelling|default_if_none:''}}</td>
                                <td>{{vp.total_indirect_cost|default_if_none:''}}</td>
                                <td>{{vp.daily_wage_loss|default_if_none:''}}</td>
                                <td>{{vp.opportunity_cost|default_if_none:''}}</td>
                                <td>{{vp.bp_med_1|default_if_none:''}}</td>
                                <td>{{vp.bp_med_2|default_if_none:''}}</td>
                                <td>{{vp.bp_med_3|default_if_none:''}}</td>
                                <td>{{vp.dm_med_1|default_if_none:''}}</td>
                                <td>{{vp.dm_med_2|default_if_none:''}}</td>
                                <td>{{vp.statins|default_if_none:''}}</td>
                                <td>{{vp.tobacco|default_if_none:''}}</td>
                                <td>{{vp.alcohol|default_if_none:''}}</td>
                                <td>{{vp.smoking|default_if_none:''}}</td>
                                <td>{{vp.family_history|default_if_none:''}}</td>
                                <td>{{vp.date|date:"d-m-Y"|default_if_none:''}}</td>
                                <td>{{vp.source_of_treatment|default_if_none:''}}</td>
                                <td>{{vp.height|default_if_none:''}}</td>
                                <td>{{vp.weight|default_if_none:''}}</td>
                                <td>{{vp.bmi|default_if_none:''}}</td>
                                <td>{{vp.sbp|default_if_none:''}}</td>
                                <td>{{vp.dbp|default_if_none:''}}</td>
                                <td>{{vp.fbs|default_if_none:''}}</td>
                                <td>{{vp.ppbs|default_if_none:''}}</td>
                                <td>{{vp.rbs|default_if_none:''}}</td>
                                <td>{{vp.diagnosis|default_if_none:''}}</td>
                                <td>{{vp.ncd_treatment|default_if_none:''}}</td>
                                <td>{{vp.non_ncd_treatment|default_if_none:''}}</td>
                                <td>{{vp.past_history|default_if_none:''}}</td>
                                <td>{{vp.remarks|default_if_none:''}}</td>
                                <td>{{vp.server_created_on|date:"d-m-Y h:i a"}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% include 'partials/pagination.html' %}
            </div>
        </div>
    </div> 
</div> 

{% endblock %}
{% block extra_javascript %}
<script src="{% static 'js/pages/form-validation.init.js' %}"></script>

<script type="text/javascript">
    $("#filter_reset").click(function() {
        $('#phc').prop('selectedIndex', 0).change();
        $('#sub_center').prop('selectedIndex', 0).change();
        $('#village').prop('selectedIndex', 0).change();
        $('#medicine').prop('selectedIndex', 0).change();
        $('#start_filter').val('');
        $('#end_filter').val('');
        this.form.submit();
    });
    document.addEventListener('DOMContentLoaded', function() { 
        $('#phc').change(function () {
            var optionSelected = $(this).find("option:selected");
            var valueSelected  = optionSelected.val();
            $.ajax({
                type:"GET",
                url: '/ajax/subcenter/'+valueSelected+'/',
                success:function(result){
                    $("#sub_center option").remove();
                    a = '<option selected value="">Choose sub center Name</option>';
                    $("#sub_center").append(a);
                    if(JSON.parse(result) == 0){
                        $("#sub_center option").remove();
                        a = '<option selected value="">No sub center is mapped to this phc</option>';
                        console.log(a)
                        $("#sub_center").append(a);
                    }
                    else{
                        $.each(JSON.parse(result),function(key, value)
                        {
                            a = '<option value=' + value['id']+'>' + value['name']+'</option>';
                            $("#sub_center").append(a);
                        });
                    }
                }
            });
        });
        $('#sub_center').change(function () {
            var optionSelected = $(this).find("option:selected");
            var valueSelected  = optionSelected.val();
            $.ajax({
                type:"GET",
                url: '/ajax/village/'+valueSelected+'/',
                success:function(result){
                    $("#village option").remove();
                    a = '<option selected value="">Choose Village Name</option>';
                    $("#village").append(a);
                    if(JSON.parse(result) == 0){
                        $("#village option").remove();
                        a = '<option selected value="">No Village is mapped to this sub center</option>';
                        console.log(a)
                        $("#village").append(a);
                    }
                    else{
                        $.each(JSON.parse(result),function(key, value)
                        {
                            a = '<option value=' + value['id']+'>' + value['name']+'</option>';
                            $("#village").append(a);
                        });
                    }
                }
            });
        });
    })
</script> 
{% endblock %}
