{% extends 'base.html' %}
{% load static %}
{% block contents %}
{% include 'partials/filter_report.html' %}
<style>
    
</style>
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="table-rep-plugin">
                    <form action=""  method="POST" >
                        {% csrf_token %}
                        <div class="d-flex justify-content-end mb-3"> 
                            {% for key, values in filter_values.items %}
                                <input type="hidden" id="__hd1__{{key}}" name='{{key}}' value="{{values}}"/>
                            {% endfor %}
                            <button type="submit" name='export'  class="btn btn-primary waves-effect justify-content-start" value="True">
                                 Export
                             </button>  
                        </div>
                    </form>
                    <div class="table-responsive mb-3" data-pattern="priority-columns">
                        <table id="tech-companies-1" class="table table-bordered dt-responsive mb-0">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>PHC Name</th>
                                    <th>Sub Centre</th>
                                    <th>Village</th>                                   
                                    <th>Consultation &lt; 30 Men</th>
                                    <th>Consultation &lt; 30 women</th>
                                    <th>Consultation &gt;= 30 and &lt;= 50 Men</th>
                                    <th>Consultation &gt;= 30 and &lt;= 50 women</th>
                                    <th>Consultation  &gt; 50 Men</th>
                                    <th>Consultation &gt; 50 women</th>
                                    <th class="total-clr">Consultation Total</th>
                                    <th>Treatment &lt; 30 Men</th>
                                    <th>Treatment &lt; 30 women</th>
                                    <th>Treatment &gt;= 30 and &lt;= 50 Men</th>
                                    <th>Treatment &gt;= 30 and &lt;= 50 women</th>
                                    <th>Treatment  &gt; 50 Men</th>
                                    <th>Treatment &gt; 50 women</th>
                                    <th class="total-clr">Treatment Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for prr in data %}
                                <tr>
                                    
                                    <th>{{prr.0}}</th>
                                    <th>{{prr.1}}</th>
                                    <th>{{prr.2}}</th>
                                    <th>{{prr.3}}</th>
                                    <th>{{prr.4}}</th>
                                    <th>{{prr.5}}</th>
                                    <th>{{prr.6}}</th>
                                    <th>{{prr.7}}</th>
                                    <th>{{prr.8}}</th>
                                    <th>{{prr.9}}</th>
                                    <th class="total-clr">{{prr.10|default_if_none:'0'}}</th>
                                    <th>{{prr.11|default_if_none:'0'}}</th>
                                    <th>{{prr.12|default_if_none:'0'}}</th>
                                    <th>{{prr.13|default_if_none:'0'}}</th>
                                    <th>{{prr.14|default_if_none:'0'}}</th>
                                    <th>{{prr.15|default_if_none:'0'}}</th>
                                    <th>{{prr.16|default_if_none:'0'}}</th>
                                    <th class="total-clr">{{prr.17|default_if_none:'0'}}</th>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% include 'partials/pagination.html' %}
            </div>
        </div>
    </div> 
</div> 
{% endblock %}
{% block extra_javascript %}
<script src="{% static 'js/pages/form-validation.init.js' %}"></script>

<script type="text/javascript">
    function onselected_start_month(){
       var start_month = document.getElementById("start_filter");
       var end_month = document.getElementById("end_filter");
       if (start_month != '' && end_month != ''){
           document.querySelector('#start_filter').required = true;
           document.querySelector('#end_filter').required = true;
       }
       else{
           document.querySelector('#start_filter').required = false;
           document.querySelector('#end_filter').required = false;
       } 
    }
    $("#start_filter").on("change", function(event){
        document.getElementById("end_filter").min=$("#start_filter").val()
    });
    $("#filter_reset").click(function() {
        $('#phc').prop('selectedIndex', 0).change();
        $('#sub_center').prop('selectedIndex', 0).change();
        $('#village').prop('selectedIndex', 0).change();
        $('#health_worker').prop('selectedIndex', 0).change();
        $('#start_filter').val('');
        $('#end_filter').val('');
        this.form.submit();
    });
    document.addEventListener('DOMContentLoaded', function() { 
        $('#phc').change(function () {
            var optionSelected = $(this).find("option:selected");
            var valueSelected  = optionSelected.val();
            $.ajax({
                type:"GET",
                url: '/ajax/subcenter/'+valueSelected+'/',
                success:function(result){
                    $("#sub_center option").remove();
                    a = '<option selected value="">Choose sub center Name</option>';
                    $("#sub_center").append(a);
                    if(JSON.parse(result) == 0){
                        $("#sub_center option").remove();
                        a = '<option selected value="">No sub center is mapped to this phc</option>';
                        console.log(a)
                        $("#sub_center").append(a);
                    }
                    else{
                        $.each(JSON.parse(result),function(key, value)
                        {
                            a = '<option value=' + value['id']+'>' + value['name']+'</option>';
                            $("#sub_center").append(a);
                        });
                    }
                }
            });
        });
        $('#sub_center').change(function () {
            var optionSelected = $(this).find("option:selected");
            var valueSelected  = optionSelected.val();
            $.ajax({
                type:"GET",
                url: '/ajax/village/'+valueSelected+'/',
                success:function(result){
                    $("#village option").remove();
                    a = '<option selected value="">Choose Village Name</option>';
                    $("#village").append(a);
                    if(JSON.parse(result) == 0){
                        $("#village option").remove();
                        a = '<option selected value="">No Village is mapped to this sub center</option>';
                        console.log(a)
                        $("#village").append(a);
                    }
                    else{
                        $.each(JSON.parse(result),function(key, value)
                        {
                            a = '<option value=' + value['id']+'>' + value['name']+'</option>';
                            $("#village").append(a);
                        });
                    }
                }
            });
        });
    })
</script> 
{% endblock %}